<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI Personality Test</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Noto Sans KR',-apple-system,BlinkMacSystemFont,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333}.container{max-width:700px;margin:0 auto;padding:20px}header{text-align:center;padding:40px 0}h1{font-size:2.5rem;color:#fff;margin-bottom:10px;text-shadow:0 2px 10px rgba(0,0,0,.2)}.subtitle{color:rgba(255,255,255,.9);font-size:1.1rem}.ad-banner{background:rgba(255,255,255,.1);border:1px dashed rgba(255,255,255,.3);padding:20px;text-align:center;margin:20px 0;border-radius:12px;color:rgba(255,255,255,.7)}.card{background:#fff;border-radius:20px;padding:30px;box-shadow:0 20px 60px rgba(0,0,0,.15);margin-bottom:20px}.intro{text-align:center}.intro h2{color:#667eea;margin-bottom:20px}.intro p{color:#666;line-height:1.8;margin-bottom:20px}.start-btn{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;padding:18px 50px;font-size:18px;border-radius:30px;cursor:pointer;transition:all .3s;font-weight:600}.start-btn:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(102,126,234,.4)}.progress-container{margin-bottom:30px}.progress-bar{height:8px;background:#eee;border-radius:4px;overflow:hidden}.progress-fill{height:100%;background:linear-gradient(135deg,#667eea,#764ba2);transition:width .3s ease}.progress-text{text-align:center;margin-top:10px;color:#888;font-size:14px}.question-section{display:none}.question-section.active{display:block;animation:fadeIn .4s ease}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.question-number{color:#667eea;font-size:14px;font-weight:600;margin-bottom:15px}.question-text{font-size:20px;color:#333;line-height:1.6;margin-bottom:30px}.options{display:flex;flex-direction:column;gap:12px}.option{padding:18px 24px;border:2px solid #eee;border-radius:12px;cursor:pointer;transition:all .3s;font-size:16px;color:#555}.option:hover{border-color:#667eea;background:rgba(102,126,234,.05)}.option.selected{border-color:#667eea;background:linear-gradient(135deg,rgba(102,126,234,.1),rgba(118,75,162,.1));color:#667eea;font-weight:500}.nav-buttons{display:flex;justify-content:space-between;margin-top:30px}.nav-btn{padding:12px 30px;border-radius:25px;cursor:pointer;font-size:15px;font-weight:500;transition:all .3s}.prev-btn{background:#f5f5f5;border:none;color:#666}.prev-btn:hover{background:#eee}.next-btn{background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff}.next-btn:hover{transform:translateY(-2px);box-shadow:0 5px 20px rgba(102,126,234,.4)}.next-btn:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}.result-section{display:none;text-align:center}.result-section.active{display:block;animation:fadeIn .5s ease}.result-type{font-size:5rem;font-weight:800;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:20px 0}.result-name{font-size:1.8rem;color:#333;margin-bottom:10px}.result-nickname{color:#667eea;font-size:1.2rem;margin-bottom:30px}.result-description{background:#f8f9ff;padding:25px;border-radius:15px;margin-bottom:25px;text-align:left}.result-description h3{color:#667eea;margin-bottom:15px}.result-description p{color:#555;line-height:1.8}.traits{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:25px}.trait{background:#f8f9ff;padding:15px;border-radius:12px;text-align:center}.trait-label{font-size:13px;color:#888;margin-bottom:5px}.trait-value{font-size:24px;font-weight:700;color:#667eea}.trait-name{font-size:12px;color:#555}.compatibility{background:#fff5f8;padding:20px;border-radius:15px;margin-bottom:25px}.compatibility h4{color:#e91e63;margin-bottom:10px}.compatibility p{color:#666}.share-buttons{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}.share-btn{padding:12px 25px;border-radius:25px;cursor:pointer;font-size:14px;font-weight:500;transition:all .3s;border:none}.share-btn.primary{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.share-btn.secondary{background:#f5f5f5;color:#666}.share-btn:hover{transform:translateY(-2px)}footer{text-align:center;padding:30px;color:rgba(255,255,255,.7);font-size:13px}@media (max-width:600px){h1{font-size:1.8rem}.result-type{font-size:3.5rem}.traits{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 data-i18n="ui.title">MBTI 테스트</h1>
            <p class="subtitle" data-i18n="ui.subtitle">12문항 약식 검사</p>
        </header>

        <div class="ad-banner">Advertisement</div>

        <div class="card">
            <div class="intro" id="introSection">
                <h2 data-i18n="ui.introTitle">나의 MBTI는?</h2>
                <p data-i18n-html="ui.introDesc">
                    12개의 간단한 질문으로 성격 유형을 알아보세요!<br>
                    너무 오래 고민하지 말고 직관적으로 답해주세요.
                </p>
                <button class="start-btn" onclick="startTest()" data-i18n="ui.startBtn">시작하기</button>
            </div>

            <div class="question-section" id="questionSection">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">1 / 12</div>
                </div>

                <div id="questionContainer"></div>

                <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="prevQuestion()" id="prevBtn" style="visibility:hidden;" data-i18n="ui.prevBtn">이전</button>
                    <button class="nav-btn next-btn" onclick="nextQuestion()" id="nextBtn" disabled data-i18n="ui.nextBtn">다음</button>
                </div>
            </div>

            <div class="result-section" id="resultSection">
                <p style="color:#888; font-size:14px;" data-i18n="ui.yourType">당신의 MBTI 유형은</p>
                <div class="result-type" id="resultType">ENFP</div>
                <div class="result-name" id="resultName"></div>
                <div class="result-nickname" id="resultNickname"></div>

                <div class="traits" id="traitsContainer"></div>

                <div class="result-description" id="resultDescription">
                    <h3 data-i18n="ui.features">성격 특성</h3>
                    <p id="descriptionText"></p>
                </div>

                <div class="compatibility" id="compatibilitySection">
                    <h4 data-i18n="ui.compatibility">잘 맞는 유형</h4>
                    <p id="compatibilityText"></p>
                </div>

                <div class="share-buttons">
                    <button class="share-btn primary" onclick="shareResult()" data-i18n="ui.share">결과 공유</button>
                    <button class="share-btn secondary" onclick="retakeTest()" data-i18n="ui.retry">다시 하기</button>
                </div>
            </div>
        </div>

        <div class="ad-banner">Advertisement</div>

        <footer data-i18n="ui.footer">
            이 테스트는 재미로만 봐주세요.
        </footer>
    </div>

    <script>
        // Get current language and i18n data
        const lang = window.currentLang || 'ko';
        const i18n = window.toolI18n || {};

        // Get questions from i18n data
        let questions = (i18n.questions && i18n.questions[lang]) ? i18n.questions[lang] : [];

        // Fallback questions if none provided
        if (questions.length === 0) {
            questions = [
                { text: "주말 계획은?", options: [{ text: "친구들과 모임", value: "E" }, { text: "집에서 휴식", value: "I" }] },
                { text: "새로운 사람들과 만날 때?", options: [{ text: "먼저 말을 건다", value: "E" }, { text: "상대방이 말 걸기를 기다린다", value: "I" }] },
                { text: "파티에 가면?", options: [{ text: "여러 사람과 이야기한다", value: "E" }, { text: "아는 사람 위주로 대화한다", value: "I" }] },
                { text: "문제를 해결할 때?", options: [{ text: "구체적인 사실에 집중한다", value: "S" }, { text: "전체적인 그림을 본다", value: "N" }] },
                { text: "새로운 아이디어가 떠오르면?", options: [{ text: "바로 실행 가능성을 따진다", value: "S" }, { text: "가능성과 의미를 먼저 생각한다", value: "N" }] },
                { text: "설명서를 읽을 때?", options: [{ text: "처음부터 끝까지 순서대로", value: "S" }, { text: "필요한 부분만 골라서", value: "N" }] },
                { text: "친구가 고민을 말할 때?", options: [{ text: "해결책을 제시한다", value: "T" }, { text: "공감하고 위로한다", value: "F" }] },
                { text: "결정을 내릴 때 더 중요한 것은?", options: [{ text: "논리와 합리성", value: "T" }, { text: "사람들의 감정", value: "F" }] },
                { text: "비판을 받으면?", options: [{ text: "객관적으로 분석한다", value: "T" }, { text: "감정이 상한다", value: "F" }] },
                { text: "여행 계획을 세울 때?", options: [{ text: "세부 일정을 미리 정한다", value: "J" }, { text: "즉흥적으로 결정한다", value: "P" }] },
                { text: "마감 기한이 있으면?", options: [{ text: "미리미리 끝낸다", value: "J" }, { text: "마감 직전에 끝낸다", value: "P" }] },
                { text: "하루 일과는?", options: [{ text: "규칙적이고 계획적", value: "J" }, { text: "유연하고 자유롭게", value: "P" }] }
            ];
        }

        // Get MBTI type data from i18n
        function getMbtiData(type) {
            const types = i18n.types || {};
            const typeData = types[type];
            if (typeData) {
                return {
                    name: typeData.name?.[lang] || typeData.name?.en || type,
                    nickname: typeData.nickname?.[lang] || typeData.nickname?.en || '',
                    match: typeData.match || '',
                    description: typeData.desc?.[lang] || typeData.desc?.en || ''
                };
            }
            // Fallback
            return { name: type, nickname: '', match: '', description: '' };
        }

        let currentQuestion = 0;
        let answers = [];

        function startTest() {
            document.getElementById('introSection').style.display = 'none';
            document.getElementById('questionSection').classList.add('active');
            showQuestion(0);
        }

        function showQuestion(index) {
            const q = questions[index];
            if (!q) return;

            const container = document.getElementById('questionContainer');
            const questionLabel = i18n.ui?.questionNum?.[lang] || '질문';

            let optionsHtml = q.options.map((opt, i) => `
                <div class="option ${answers[index] === opt.value ? 'selected' : ''}" onclick="selectOption(${i}, '${opt.value}')">
                    ${opt.text}
                </div>
            `).join('');

            container.innerHTML = `
                <div class="question-number">${questionLabel} ${index + 1}</div>
                <div class="question-text">${q.text}</div>
                <div class="options">${optionsHtml}</div>
            `;

            updateProgress();
            updateButtons();
        }

        function selectOption(optionIndex, value) {
            answers[currentQuestion] = value;
            document.querySelectorAll('.option').forEach((opt, i) => {
                opt.classList.toggle('selected', i === optionIndex);
            });
            updateButtons();
        }

        function updateProgress() {
            const percent = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = `${currentQuestion + 1} / ${questions.length}`;
        }

        function updateButtons() {
            document.getElementById('prevBtn').style.visibility = currentQuestion > 0 ? 'visible' : 'hidden';
            document.getElementById('nextBtn').disabled = !answers[currentQuestion];

            const isLast = currentQuestion === questions.length - 1;
            const nextText = i18n.ui?.nextBtn?.[lang] || '다음';
            const resultText = i18n.ui?.resultBtn?.[lang] || '결과 보기';
            document.getElementById('nextBtn').textContent = isLast ? resultText : nextText;
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        }

        function nextQuestion() {
            if (!answers[currentQuestion]) return;

            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
            } else {
                showResult();
            }
        }

        function calculateMBTI() {
            let E = 0, I = 0, S = 0, N = 0, T = 0, F = 0, J = 0, P = 0;
            answers.forEach(answer => {
                if (answer === 'E') E++; if (answer === 'I') I++;
                if (answer === 'S') S++; if (answer === 'N') N++;
                if (answer === 'T') T++; if (answer === 'F') F++;
                if (answer === 'J') J++; if (answer === 'P') P++;
            });
            return {
                type: (E >= I ? 'E' : 'I') + (S >= N ? 'S' : 'N') + (T >= F ? 'T' : 'F') + (J >= P ? 'J' : 'P'),
                scores: { E, I, S, N, T, F, J, P }
            };
        }

        function showResult() {
            document.getElementById('questionSection').classList.remove('active');
            document.getElementById('resultSection').classList.add('active');

            const result = calculateMBTI();
            const data = getMbtiData(result.type);

            document.getElementById('resultType').textContent = result.type;
            document.getElementById('resultName').textContent = data.name;
            document.getElementById('resultNickname').textContent = data.nickname;
            document.getElementById('descriptionText').textContent = data.description;
            document.getElementById('compatibilityText').textContent = data.match;

            const scores = result.scores;
            document.getElementById('traitsContainer').innerHTML = `
                <div class="trait"><div class="trait-value">${scores.E > scores.I ? 'E' : 'I'}</div><div class="trait-name">${scores.E > scores.I ? 'Extrovert' : 'Introvert'}</div></div>
                <div class="trait"><div class="trait-value">${scores.S > scores.N ? 'S' : 'N'}</div><div class="trait-name">${scores.S > scores.N ? 'Sensing' : 'iNtuition'}</div></div>
                <div class="trait"><div class="trait-value">${scores.T > scores.F ? 'T' : 'F'}</div><div class="trait-name">${scores.T > scores.F ? 'Thinking' : 'Feeling'}</div></div>
                <div class="trait"><div class="trait-value">${scores.J > scores.P ? 'J' : 'P'}</div><div class="trait-name">${scores.J > scores.P ? 'Judging' : 'Perceiving'}</div></div>
            `;
        }

        function shareResult() {
            const result = calculateMBTI();
            const data = getMbtiData(result.type);
            const text = `My MBTI: ${result.type} - ${data.name}`;
            if (navigator.share) {
                navigator.share({ title: 'MBTI Test Result', text: text });
            } else {
                navigator.clipboard.writeText(text);
                alert('Copied: ' + text);
            }
        }

        function retakeTest() {
            currentQuestion = 0;
            answers = [];
            document.getElementById('resultSection').classList.remove('active');
            document.getElementById('introSection').style.display = 'block';
        }
    </script>
</body>
</html>
