<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLフォーマッター - 無料オンラインSQL整形ツール</title>
    <meta name="description" content="無料オンラインSQLフォーマッター・整形ツール。SQLクエリを即座に整形し、見やすくします。MySQL、PostgreSQL、Oracle、SQL Serverをサポート。">
    <meta name="keywords" content="SQLフォーマッター, SQL整形, SQLフォーマット, SQL beautify, SQLオンラインツール, クエリ整形">
    <meta name="robots" content="index, follow">

    <meta property="og:title" content="SQLフォーマッター - 無料オンラインSQL整形ツール">
    <meta property="og:description" content="SQLクエリを即座に整形し、見やすくします。無料オンラインツール。">
    <meta property="og:type" content="website">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e4e4e4;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }

        .lang-switch {
            position: absolute;
            top: 0;
            right: 0;
        }

        .lang-switch a {
            color: #888;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .lang-switch a:hover {
            border-color: #00b4db;
            color: #00b4db;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #00b4db, #0083b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 1.1rem;
        }

        .ad-banner {
            background: rgba(255,255,255,0.05);
            border: 1px dashed rgba(255,255,255,0.2);
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            border-radius: 8px;
            color: #666;
        }

        .options-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }

        .option-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-group label {
            color: #888;
            font-size: 14px;
        }

        select {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #e4e4e4;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            cursor: pointer;
        }

        select option {
            background: #1a1a2e;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 1.8rem; }
            .lang-switch { position: static; margin-bottom: 20px; }
            header { padding-top: 10px; }
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            overflow: hidden;
        }

        .panel-header {
            background: rgba(255,255,255,0.08);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .panel-title {
            font-weight: 600;
            color: #00b4db;
        }

        .panel-actions {
            display: flex;
            gap: 10px;
        }

        textarea {
            width: 100%;
            height: 450px;
            background: transparent;
            border: none;
            padding: 20px;
            color: #e4e4e4;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
            line-height: 1.6;
        }

        .output-area {
            height: 450px;
            overflow: auto;
            padding: 20px;
        }

        pre {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00b4db, #0083b0);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 180, 219, 0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e4e4e4;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            background: rgba(0,0,0,0.2);
            font-size: 13px;
            color: #888;
        }

        /* SQL Syntax Highlighting */
        .sql-keyword { color: #00b4db; font-weight: bold; }
        .sql-function { color: #ffd93d; }
        .sql-string { color: #ff6b6b; }
        .sql-number { color: #ff9f43; }
        .sql-comment { color: #666; font-style: italic; }
        .sql-operator { color: #e4e4e4; }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0, 180, 219, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .feature {
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .feature h3 {
            color: #00b4db;
            margin-bottom: 10px;
        }

        .feature p {
            color: #888;
            font-size: 14px;
        }

        footer {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .samples {
            margin-top: 30px;
        }

        .samples h3 {
            color: #00b4db;
            margin-bottom: 15px;
            text-align: center;
        }

        .sample-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .sample-btn {
            padding: 8px 16px;
            background: rgba(0, 180, 219, 0.2);
            border: 1px solid rgba(0, 180, 219, 0.3);
            color: #00b4db;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .sample-btn:hover {
            background: rgba(0, 180, 219, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="lang-switch">
                <a href="index.html">English</a>
            </div>
            <h1>SQLフォーマッター</h1>
            <p class="subtitle">SQLクエリを即座に整形し、見やすくします</p>
        </header>

        <div class="ad-banner">広告</div>

        <div class="options-bar">
            <div class="option-group">
                <label>インデント:</label>
                <select id="indent">
                    <option value="2">スペース2個</option>
                    <option value="4" selected>スペース4個</option>
                    <option value="tab">タブ</option>
                </select>
            </div>
            <div class="option-group">
                <label>キーワード:</label>
                <select id="keywordCase">
                    <option value="upper" selected>大文字</option>
                    <option value="lower">小文字</option>
                    <option value="capitalize">先頭のみ大文字</option>
                </select>
            </div>
            <div class="option-group">
                <label>SQL種類:</label>
                <select id="dialect">
                    <option value="standard">標準SQL</option>
                    <option value="mysql">MySQL</option>
                    <option value="postgresql">PostgreSQL</option>
                    <option value="oracle">Oracle</option>
                </select>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="formatSQL()">SQL整形</button>
            <button class="btn btn-secondary" onclick="minifySQL()">圧縮</button>
            <button class="btn btn-secondary" onclick="clearAll()">クリア</button>
        </div>

        <div class="main-content">
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">入力SQL</span>
                    <div class="panel-actions">
                        <button class="btn btn-small btn-secondary" onclick="pasteFromClipboard()">貼り付け</button>
                    </div>
                </div>
                <textarea id="input" placeholder="SQLクエリをここに貼り付けてください..."></textarea>
                <div class="status-bar">
                    <span id="inputStatus">準備完了</span>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">整形された結果</span>
                    <div class="panel-actions">
                        <button class="btn btn-small btn-secondary" onclick="copyOutput()">コピー</button>
                        <button class="btn btn-small btn-secondary" onclick="downloadSQL()">ダウンロード</button>
                    </div>
                </div>
                <div class="output-area">
                    <pre id="output"></pre>
                </div>
                <div class="status-bar">
                    <span id="outputStatus">-</span>
                </div>
            </div>
        </div>

        <div class="samples">
            <h3>サンプルクエリを試す</h3>
            <div class="sample-buttons">
                <button class="sample-btn" onclick="loadSample('select')">SELECT</button>
                <button class="sample-btn" onclick="loadSample('join')">JOIN</button>
                <button class="sample-btn" onclick="loadSample('subquery')">サブクエリ</button>
                <button class="sample-btn" onclick="loadSample('insert')">INSERT</button>
                <button class="sample-btn" onclick="loadSample('update')">UPDATE</button>
                <button class="sample-btn" onclick="loadSample('create')">CREATE TABLE</button>
            </div>
        </div>

        <div class="features">
            <div class="feature">
                <div class="feature-icon">&#128295;</div>
                <h3>スマート整形</h3>
                <p>読みやすいSQLのためのインテリジェントなインデントと改行</p>
            </div>
            <div class="feature">
                <div class="feature-icon">&#127912;</div>
                <h3>構文強調表示</h3>
                <p>キーワード、文字列、関数を色分け</p>
            </div>
            <div class="feature">
                <div class="feature-icon">&#9881;</div>
                <h3>カスタマイズ可能</h3>
                <p>インデントスタイル、キーワード大文字小文字、SQL種類を選択</p>
            </div>
            <div class="feature">
                <div class="feature-icon">&#128274;</div>
                <h3>安全でプライベート</h3>
                <p>すべての処理がブラウザで行われます</p>
            </div>
        </div>

        <div class="ad-banner">広告</div>

        <footer>
            <p>無料SQLフォーマッターツール | サーバーにデータが送信されません</p>
        </footer>
    </div>

    <div class="toast" id="toast">コピーしました!</div>

    <script>
        const input = document.getElementById('input');
        const output = document.getElementById('output');

        const keywords = [
            'SELECT', 'FROM', 'WHERE', 'AND', 'OR', 'NOT', 'IN', 'LIKE', 'BETWEEN',
            'JOIN', 'INNER', 'LEFT', 'RIGHT', 'OUTER', 'FULL', 'CROSS', 'ON',
            'GROUP', 'BY', 'HAVING', 'ORDER', 'ASC', 'DESC', 'LIMIT', 'OFFSET',
            'INSERT', 'INTO', 'VALUES', 'UPDATE', 'SET', 'DELETE',
            'CREATE', 'TABLE', 'ALTER', 'DROP', 'INDEX', 'VIEW', 'DATABASE',
            'PRIMARY', 'KEY', 'FOREIGN', 'REFERENCES', 'CONSTRAINT', 'UNIQUE',
            'NULL', 'NOT NULL', 'DEFAULT', 'AUTO_INCREMENT', 'IDENTITY',
            'AS', 'DISTINCT', 'ALL', 'UNION', 'INTERSECT', 'EXCEPT',
            'CASE', 'WHEN', 'THEN', 'ELSE', 'END', 'IF', 'EXISTS',
            'COUNT', 'SUM', 'AVG', 'MAX', 'MIN', 'COALESCE', 'CAST',
            'VARCHAR', 'INT', 'INTEGER', 'BIGINT', 'DECIMAL', 'FLOAT', 'BOOLEAN',
            'DATE', 'DATETIME', 'TIMESTAMP', 'TEXT', 'BLOB', 'TRUE', 'FALSE'
        ];

        const functions = [
            'COUNT', 'SUM', 'AVG', 'MAX', 'MIN', 'COALESCE', 'CAST', 'CONVERT',
            'CONCAT', 'SUBSTRING', 'LENGTH', 'UPPER', 'LOWER', 'TRIM', 'LTRIM', 'RTRIM',
            'NOW', 'GETDATE', 'DATEADD', 'DATEDIFF', 'YEAR', 'MONTH', 'DAY',
            'ROUND', 'FLOOR', 'CEIL', 'ABS', 'MOD', 'POWER', 'SQRT',
            'ISNULL', 'NULLIF', 'IIF', 'REPLACE', 'CHARINDEX', 'PATINDEX'
        ];

        const newLineKeywords = ['SELECT', 'FROM', 'WHERE', 'AND', 'OR', 'JOIN', 'LEFT JOIN', 'RIGHT JOIN', 'INNER JOIN', 'OUTER JOIN', 'GROUP BY', 'ORDER BY', 'HAVING', 'LIMIT', 'UNION', 'INSERT', 'INTO', 'VALUES', 'UPDATE', 'SET', 'DELETE', 'CREATE', 'ALTER', 'DROP'];

        function getIndent() {
            const val = document.getElementById('indent').value;
            return val === 'tab' ? '\t' : ' '.repeat(parseInt(val));
        }

        function transformKeyword(word) {
            const caseOption = document.getElementById('keywordCase').value;
            if (caseOption === 'upper') return word.toUpperCase();
            if (caseOption === 'lower') return word.toLowerCase();
            return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
        }

        function formatSQL() {
            let sql = input.value.trim();
            if (!sql) {
                showToast('SQLを入力してください');
                return;
            }

            const indent = getIndent();
            let formatted = sql;

            // Normalize whitespace
            formatted = formatted.replace(/\s+/g, ' ');

            // Handle keywords with proper casing
            keywords.forEach(kw => {
                const regex = new RegExp('\\b' + kw + '\\b', 'gi');
                formatted = formatted.replace(regex, transformKeyword(kw));
            });

            // Add newlines before major keywords
            const majorKeywords = ['SELECT', 'FROM', 'WHERE', 'GROUP BY', 'ORDER BY', 'HAVING', 'LIMIT', 'OFFSET', 'UNION', 'INTERSECT', 'EXCEPT'];
            majorKeywords.forEach(kw => {
                const regex = new RegExp('\\s+' + transformKeyword(kw) + '\\b', 'gi');
                formatted = formatted.replace(regex, '\n' + transformKeyword(kw));
            });

            // Handle JOINs
            const joinKeywords = ['INNER JOIN', 'LEFT JOIN', 'RIGHT JOIN', 'FULL JOIN', 'CROSS JOIN', 'LEFT OUTER JOIN', 'RIGHT OUTER JOIN', 'FULL OUTER JOIN', 'JOIN'];
            joinKeywords.forEach(kw => {
                const regex = new RegExp('\\s+' + transformKeyword(kw).replace(/ /g, '\\s+') + '\\b', 'gi');
                formatted = formatted.replace(regex, '\n' + transformKeyword(kw));
            });

            // Handle AND/OR
            formatted = formatted.replace(/\s+(AND|OR)\s+/gi, (match, p1) => '\n' + indent + transformKeyword(p1) + ' ');

            // Handle ON
            formatted = formatted.replace(/\s+ON\s+/gi, '\n' + indent + transformKeyword('ON') + ' ');

            // Handle commas in SELECT
            formatted = formatted.replace(/,\s*/g, ',\n' + indent);

            // Handle SET in UPDATE
            formatted = formatted.replace(/\s+SET\s+/gi, '\n' + transformKeyword('SET') + ' ');

            // Handle VALUES
            formatted = formatted.replace(/\s+VALUES\s+/gi, '\n' + transformKeyword('VALUES') + ' ');

            // Indent content after SELECT, FROM etc
            const lines = formatted.split('\n');
            let result = [];
            let indentLevel = 0;

            for (let line of lines) {
                line = line.trim();
                if (!line) continue;

                // Check for closing parenthesis
                if (line.startsWith(')')) {
                    indentLevel = Math.max(0, indentLevel - 1);
                }

                // Check if line starts with sub-clause
                const startsWithIndent = /^(AND|OR|ON|,)/i.test(line);

                if (startsWithIndent && indentLevel === 0) {
                    result.push(indent + line);
                } else {
                    result.push(indent.repeat(indentLevel) + line);
                }

                // Check for opening parenthesis for subqueries
                if (line.includes('(') && !line.includes(')')) {
                    indentLevel++;
                }
            }

            formatted = result.join('\n');

            // Highlight syntax
            output.innerHTML = highlightSQL(formatted);
            document.getElementById('outputStatus').textContent = '整形完了';
            showToast('SQL整形が完了しました!');
        }

        function highlightSQL(sql) {
            let highlighted = escapeHtml(sql);

            // Highlight strings
            highlighted = highlighted.replace(/'([^']*)'/g, '<span class="sql-string">\'$1\'</span>');

            // Highlight numbers
            highlighted = highlighted.replace(/\b(\d+\.?\d*)\b/g, '<span class="sql-number">$1</span>');

            // Highlight functions
            functions.forEach(fn => {
                const regex = new RegExp('\\b(' + fn + ')\\s*\\(', 'gi');
                highlighted = highlighted.replace(regex, '<span class="sql-function">$1</span>(');
            });

            // Highlight keywords
            keywords.forEach(kw => {
                const regex = new RegExp('\\b(' + kw + ')\\b', 'gi');
                highlighted = highlighted.replace(regex, '<span class="sql-keyword">$1</span>');
            });

            // Highlight comments
            highlighted = highlighted.replace(/(--.*$)/gm, '<span class="sql-comment">$1</span>');
            highlighted = highlighted.replace(/(\/\*[\s\S]*?\*\/)/g, '<span class="sql-comment">$1</span>');

            return highlighted;
        }

        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;');
        }

        function minifySQL() {
            let sql = input.value.trim();
            if (!sql) {
                showToast('SQLを入力してください');
                return;
            }

            // Remove comments
            sql = sql.replace(/--.*$/gm, '');
            sql = sql.replace(/\/\*[\s\S]*?\*\//g, '');

            // Collapse whitespace
            sql = sql.replace(/\s+/g, ' ').trim();

            output.textContent = sql;
            document.getElementById('outputStatus').textContent = '圧縮完了';
            showToast('SQL圧縮が完了しました!');
        }

        function clearAll() {
            input.value = '';
            output.innerHTML = '';
            document.getElementById('inputStatus').textContent = '準備完了';
            document.getElementById('outputStatus').textContent = '-';
        }

        const samples = {
            select: `select id, first_name, last_name, email, created_at from users where status = 'active' and created_at > '2024-01-01' order by created_at desc limit 100`,

            join: `select u.id, u.name, o.order_id, o.total, p.product_name from users u inner join orders o on u.id = o.user_id left join order_items oi on o.order_id = oi.order_id left join products p on oi.product_id = p.id where o.status = 'completed' and o.created_at between '2024-01-01' and '2024-12-31'`,

            subquery: `select * from employees where department_id in (select id from departments where budget > (select avg(budget) from departments)) and salary > (select avg(salary) from employees)`,

            insert: `insert into users (first_name, last_name, email, password, status, created_at) values ('太郎', '山田', 'taro@example.com', 'hashed_password', 'active', now())`,

            update: `update products set price = price * 1.10, updated_at = now() where category_id = 5 and stock_quantity > 0 and last_sale_date < '2024-01-01'`,

            create: `create table orders (id int primary key auto_increment, user_id int not null, total decimal(10,2) default 0.00, status varchar(50) default 'pending', created_at timestamp default current_timestamp, foreign key (user_id) references users(id))`
        };

        function loadSample(type) {
            input.value = samples[type];
            document.getElementById('inputStatus').textContent = 'サンプル読み込み完了';
            showToast('サンプルが読み込まれました!');
        }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                input.value = text;
                showToast('貼り付けました!');
            } catch (e) {
                showToast('貼り付けに失敗しました');
            }
        }

        function copyOutput() {
            const text = output.textContent;
            if (!text) {
                showToast('コピーする内容がありません');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                showToast('コピーしました!');
            });
        }

        function downloadSQL() {
            const text = output.textContent;
            if (!text) {
                showToast('ダウンロードする内容がありません');
                return;
            }
            const blob = new Blob([text], { type: 'text/sql' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'formatted.sql';
            a.click();
            URL.revokeObjectURL(url);
            showToast('ダウンロードしました!');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
    </script>
</body>
</html>
